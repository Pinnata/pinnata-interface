{"ast":null,"code":"var _jsxFileName = \"/Users/kylescott/src/nomspace-interface/src/pages/Position/Position.tsx\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport { useContractKit } from \"@celo-tools/use-contractkit\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\";\nimport { getAddress } from \"ethers/lib/utils\";\nimport { Bank } from \"src/config\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\nimport { FARMS } from \"src/config\";\nimport { Spinner, Flex } from \"theme-ui\";\nimport { PositionEntry } from \"src/pages/Position/PositionEntry\";\nimport { Container, Title, Description, Wrapper, Background, CardContainer } from \"src/components/MainPages\";\nimport Image from 'src/images/background.png';\nimport { SimpleTable } from \"src/components/SimpleTable\";\nimport { css } from \"@emotion/react\";\nimport IERC20W_ABI from \"src/abis/dahlia_contracts/IERC20Wrapper.json\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Position = () => {\n  _s();\n\n  const {\n    kit,\n    address\n  } = useContractKit();\n  const bank = React.useMemo(() => new kit.web3.eth.Contract(BANK_ABI.abi, getAddress(Bank[42220])), [kit]);\n  const call = React.useCallback(async () => {\n    try {\n      const info = [];\n      const nextPositionId = await bank.methods.nextPositionId().call();\n\n      for (let i = 1; i < Number(nextPositionId); i += 1) {\n        const positionInfo = await bank.methods.getPositionInfo(i).call();\n        const wrapper = new kit.web3.eth.Contract(IERC20W_ABI.abi, positionInfo.collToken);\n        const underlying = await wrapper.methods.getUnderlyingToken(positionInfo.collId).call();\n\n        for (let farm of FARMS) {\n          if (getAddress(underlying) === farm.lp && getAddress(positionInfo.owner) === getAddress(address)) {\n            info.push({\n              collId: positionInfo.collId,\n              collateralSize: positionInfo.collateralSize,\n              collToken: positionInfo.collToken,\n              positionId: i,\n              farm: farm\n            });\n          }\n        }\n      }\n\n      return info;\n    } catch (error) {\n      console.log(error);\n    }\n  }, [bank.methods, kit.web3.eth.Contract, address]);\n  const [info] = useAsyncState(null, call);\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: [/*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(Title, {\n        children: \"Positions\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Description, {\n        children: \"Manage your positions with ease.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CardContainer, {\n      children: /*#__PURE__*/_jsxDEV(SimpleTable, {\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              css: css`\n                  text-align: left !important;\n                `,\n              children: \"Pool\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 75,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Borrow Value\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 82,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Total Value\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 83,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Debt Ratio \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 84,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"APY\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 85,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 86,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: info ? info.map(x => /*#__PURE__*/_jsxDEV(PositionEntry, {\n            collId: info.collId,\n            collateralSize: info.collateralSize,\n            positionId: info.pos.positonId,\n            pool: info.active[0]\n          }, info.positionId, false, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 15\n          }, this)) : /*#__PURE__*/_jsxDEV(Flex, {\n            sx: {\n              alignItems: \"center\",\n              justifyContent: \"center\"\n            },\n            children: /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 95,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 14\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Background, {\n      src: Image,\n      alt: \"Background Logo\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Position, \"mHfQXYEl6HAYxdaLEEz5GnqHxqw=\", false, function () {\n  return [useContractKit, useAsyncState];\n});\n\n_c = Position;\nexport default Position;\n\nvar _c;\n\n$RefreshReg$(_c, \"Position\");","map":{"version":3,"sources":["/Users/kylescott/src/nomspace-interface/src/pages/Position/Position.tsx"],"names":["React","useContractKit","BANK_ABI","getAddress","Bank","useAsyncState","FARMS","Spinner","Flex","PositionEntry","Container","Title","Description","Wrapper","Background","CardContainer","Image","SimpleTable","css","IERC20W_ABI","Position","kit","address","bank","useMemo","web3","eth","Contract","abi","call","useCallback","info","nextPositionId","methods","i","Number","positionInfo","getPositionInfo","wrapper","collToken","underlying","getUnderlyingToken","collId","farm","lp","owner","push","collateralSize","positionId","error","console","log","map","x","pos","positonId","active","alignItems","justifyContent"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useContractKit } from \"@celo-tools/use-contractkit\";\nimport { AbiItem, toBN } from \"web3-utils\";\nimport { HomoraBank } from \"src/generated/HomoraBank\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\";\nimport { getAddress } from \"ethers/lib/utils\";\nimport { Bank } from \"src/config\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\nimport { FARMS } from \"src/config\";\nimport { Spinner, Flex } from \"theme-ui\";\nimport { PositionEntry } from \"src/pages/Position/PositionEntry\"\nimport {\n    Container, \n    Title, \n    Description,\n    Wrapper,\n    Background,\n    CardContainer,\n} from \"src/components/MainPages\";\nimport Image from 'src/images/background.png';\nimport { SimpleTable } from \"src/components/SimpleTable\";\nimport { css } from \"@emotion/react\";\nimport { IERC20Wrapper } from 'src/generated/IERC20Wrapper';\nimport IERC20W_ABI from \"src/abis/dahlia_contracts/IERC20Wrapper.json\";\n\n\nconst Position = () => {\n  const { kit, address } = useContractKit();\n\n  const bank = React.useMemo(() => (new kit.web3.eth.Contract(\n    BANK_ABI.abi as AbiItem[],\n    getAddress(Bank[42220])\n  ) as unknown) as HomoraBank, [kit]); \n\n  const call = React.useCallback(async () => {\n    try {\n      const info = [];\n      const nextPositionId = await bank.methods.nextPositionId().call(); \n      for (let i = 1; i < Number(nextPositionId); i += 1) {\n        const positionInfo = await bank.methods.getPositionInfo(i).call();\n        const wrapper = (new kit.web3.eth.Contract(\n          IERC20W_ABI.abi as AbiItem[],\n          positionInfo.collToken,\n          ) as unknown) as IERC20Wrapper;\n        const underlying = await wrapper.methods.getUnderlyingToken(positionInfo.collId).call(); \n        for (let farm of FARMS) {\n          if (getAddress(underlying) === farm.lp && getAddress(positionInfo.owner) === getAddress(address!)) {\n            info.push({\n              collId: positionInfo.collId, \n              collateralSize: positionInfo.collateralSize,\n              collToken: positionInfo.collToken,\n              positionId: i,\n              farm: farm,\n            })\n          }\n        }\n      }\n      return info;  \n    } catch (error) {\n        console.log(error)\n    }  \n}, [bank.methods, kit.web3.eth.Contract, address])\n\n  const [info] = useAsyncState(null, call);\n  return (\n    <Wrapper>\n      <Container>\n        <Title>Positions</Title>\n        <Description>Manage your positions with ease.</Description>\n      </Container>\n      <CardContainer>\n        <SimpleTable>\n          <thead>\n            <tr>\n              <th\n                css={css`\n                  text-align: left !important;\n                `}\n              >\n                Pool\n              </th>\n              <th>Borrow Value</th>\n              <th>Total Value</th>\n              <th>Debt Ratio </th>\n              <th>APY</th>\n              <th />\n            </tr>\n          </thead>\n          <tbody>\n            { info ? \n              info.map((x) => (\n              <PositionEntry key={info.positionId} collId={info.collId} collateralSize={info.collateralSize} positionId={info.pos.positonId} pool={info.active[0]!} />\n            )) : \n            (<Flex sx={{ alignItems: \"center\", justifyContent: \"center\"}}>\n              <Spinner />\n            </Flex>)\n            }\n            \n          </tbody>\n        </SimpleTable>\n      </CardContainer>\n      <Background src={Image} alt='Background Logo' />\n    </Wrapper>\n  );\n};\n\nexport default Position;\n"]},"metadata":{},"sourceType":"module"}