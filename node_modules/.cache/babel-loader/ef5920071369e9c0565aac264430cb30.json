{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useContractKit } from \"@celo-tools/use-contractkit\";\nimport { toBN } from \"web3-utils\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\";\nimport CERC20_ABI from \"src/abis/fountain_of_youth/CErc20Immutable.json\";\nimport { Bank } from \"src/config\";\nimport React from \"react\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\nimport { getAddress } from \"ethers/lib/utils\";\n\n/**\n * (Projected) APY: homoraBank.banks(token).ctoken.interestRateModel.getSupplyRate(\n * Total Supply,\n * total Borrow,\n * homoraBank.banks(token).ctoken.totalReserves(),\n * homoraBank.banks(token).ctoken.reserveFactorMantissa())\n *\n * Total Supply: homoraBank.banks(token).ctoken.totalSupply()\n * Total Borrow: homoraBank.banks(token).ctoken.totalBorrows()\n * Utilization: jumpRateModel.utilizationRate(Total Supply, Total Borrow, homoraBank.banks(token).ctoken.totalReserves()\n * Balance: safeBox.balanceOf(address)\n */\nexport const useEarnPool = token => {\n  _s();\n\n  const {\n    kit,\n    network\n  } = useContractKit(); //TODO: flag wrong chain id's\n\n  const bank = React.useMemo(() => new kit.web3.eth.Contract(BANK_ABI.abi, getAddress(Bank[network.chainId])), [kit, network]);\n  const call = React.useCallback(async () => {\n    try {\n      const bankInfo = await bank.methods.getBankInfo(token.address).call();\n      const cToken = new kit.web3.eth.Contract(CERC20_ABI, bankInfo.cToken);\n      const totalSupply = await cToken.methods.totalSupply().call();\n      const totalBorrows = await cToken.methods.totalBorrows().call();\n      const totalReserves = await cToken.methods.totalReserves().call();\n      return {\n        totalSupply,\n        totalBorrows,\n        totalReserves\n      };\n    } catch (error) {\n      console.log(error);\n    }\n  }, [bank, token.address]);\n  const [tokenInfo] = useAsyncState(null, call);\n  console.log('tokenInfo', tokenInfo);\n  if (tokenInfo == null) return null;\n  const {\n    totalSupply,\n    totalBorrows,\n    totalReserves\n  } = tokenInfo;\n  console.log(\"ere\", toBN(totalSupply));\n  return null; // const {\n  //     totalSupply,\n  //     totalBorrows, \n  //     totalReserves,\n  // } = tokenInfo;\n  // return {\n  //     totalSupply: toBN(totalSupply),\n  //     totalBorrows: toBN(totalBorrows),\n  //     totalReserves: toBN(totalReserves),\n  //     utilizationRate: toBN(0),\n  //     projectedAPY: toBN(0),\n  // };\n  //   const [cToken, setCToken] = useState<CToken | null>(null);\n  //   useEffect(() => {\n  //     void (async () => {\n  //       try {\n  //         const { cToken: cTokenAddress } = await bank.getBankInfo(token.address);\n  //         setCToken(CToken__factory.connect(cTokenAddress, provider));\n  //       } catch (e) {\n  //         console.error(\"Could not fetch cToken\", e);\n  //         Sentry.captureException(e);\n  //         return;\n  //       }\n  //     })();\n  //   }, [bank, provider, token]);\n  //   const [info, setInfo] = useState<{\n  //     totalReserves: TokenAmount;\n  //     totalSupply: TokenAmount;\n  //     totalBorrows: TokenAmount;\n  //     utilizationRate: BigNumber;\n  //     projectedAPY: BigNumber;\n  //   } | null>(null);\n  //   useEffect(() => {\n  //     void (async () => {\n  //       if (!cToken) {\n  //         setInfo(null);\n  //         return;\n  //       }\n  //       try {\n  //         const interestRateModelAddress = await cToken.interestRateModel();\n  //         const interestRateModel = JumpRateModelV2__factory.connect(\n  //           interestRateModelAddress,\n  //           provider\n  //         );\n  //         const info = {\n  //           totalReserves: await cToken.totalReserves(),\n  //           totalSupply: await cToken.totalSupply(),\n  //           totalBorrows: await cToken.totalBorrows(),\n  //           reserveFactorMantissa: await cToken.reserveFactorMantissa(),\n  //         };\n  //         const utilizationRate = await interestRateModel.utilizationRate(\n  //           info.totalSupply,\n  //           info.totalBorrows,\n  //           info.totalReserves\n  //         );\n  //         const supplyRate = await interestRateModel.getSupplyRate(\n  //           info.totalSupply,\n  //           info.totalBorrows,\n  //           info.totalReserves,\n  //           info.reserveFactorMantissa\n  //         );\n  //         setInfo({\n  //           totalSupply: new TokenAmount(token, info.totalSupply.toString()),\n  //           totalBorrows: new TokenAmount(token, info.totalBorrows.toString()),\n  //           totalReserves: new TokenAmount(token, info.totalReserves.toString()),\n  //           utilizationRate,\n  //           projectedAPY: supplyRate,\n  //         });\n  //       } catch (e) {\n  //         console.error(\"Could not fetch pool data\", e);\n  //         Sentry.captureException(e);\n  //         return;\n  //       }\n  //     })();\n  //   }, [cToken, provider, token]);\n  //   return info;\n};\n\n_s(useEarnPool, \"laJ65aA+83HsAG24vsLPDtwUifw=\", false, function () {\n  return [useContractKit, useAsyncState];\n});","map":{"version":3,"sources":["/Users/kylescott/src/nomspace-interface/src/components/useEarnPool.ts"],"names":["useContractKit","toBN","BANK_ABI","CERC20_ABI","Bank","React","useAsyncState","getAddress","useEarnPool","token","kit","network","bank","useMemo","web3","eth","Contract","abi","chainId","call","useCallback","bankInfo","methods","getBankInfo","address","cToken","totalSupply","totalBorrows","totalReserves","error","console","log","tokenInfo"],"mappings":";;AAAA,SAASA,cAAT,QAA+B,6BAA/B;AAIA,SAAkBC,IAAlB,QAAyC,YAAzC;AAEA,OAAOC,QAAP,MAAqB,2CAArB;AACA,OAAOC,UAAP,MAAuB,iDAAvB;AAGA,SAASC,IAAT,QAAqB,YAArB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,aAAT,QAA8B,yBAA9B;AACA,SAASC,UAAT,QAA2B,kBAA3B;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,WAAW,GACtBC,KADyB,IAQf;AAAA;;AACR,QAAM;AAAEC,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAmBX,cAAc,EAAvC,CADQ,CAER;;AACA,QAAMY,IAAI,GAAGP,KAAK,CAACQ,OAAN,CAAc,MAAO,IAAIH,GAAG,CAACI,IAAJ,CAASC,GAAT,CAAaC,QAAjB,CAC9Bd,QAAQ,CAACe,GADqB,EAE9BV,UAAU,CAACH,IAAI,CAACO,OAAO,CAACO,OAAT,CAAL,CAFoB,CAArB,EAGgB,CAACR,GAAD,EAAMC,OAAN,CAHhB,CAAb;AAIA,QAAMQ,IAAI,GAAGd,KAAK,CAACe,WAAN,CAAkB,YAAY;AACvC,QAAI;AACA,YAAMC,QAAQ,GAAI,MAAMT,IAAI,CAACU,OAAL,CAAaC,WAAb,CAAyBd,KAAK,CAACe,OAA/B,EAAwCL,IAAxC,EAAxB;AACA,YAAMM,MAAM,GAAI,IAAIf,GAAG,CAACI,IAAJ,CAASC,GAAT,CAAaC,QAAjB,CACZb,UADY,EAEZkB,QAAQ,CAACI,MAFG,CAAhB;AAIA,YAAMC,WAAW,GAAG,MAAMD,MAAM,CAACH,OAAP,CAAeI,WAAf,GAA6BP,IAA7B,EAA1B;AACA,YAAMQ,YAAY,GAAG,MAAMF,MAAM,CAACH,OAAP,CAAeK,YAAf,GAA8BR,IAA9B,EAA3B;AACA,YAAMS,aAAa,GAAG,MAAMH,MAAM,CAACH,OAAP,CAAeM,aAAf,GAA+BT,IAA/B,EAA5B;AACA,aAAO;AACHO,QAAAA,WADG;AAEHC,QAAAA,YAFG;AAGHC,QAAAA;AAHG,OAAP;AAKH,KAdD,CAcE,OAAOC,KAAP,EAAc;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACH;AAEJ,GAnBY,EAmBV,CAACjB,IAAD,EAAOH,KAAK,CAACe,OAAb,CAnBU,CAAb;AAqBA,QAAM,CAACQ,SAAD,IAAc1B,aAAa,CAAC,IAAD,EAAOa,IAAP,CAAjC;AACAW,EAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBC,SAAzB;AAEA,MAAIA,SAAS,IAAI,IAAjB,EAAuB,OAAO,IAAP;AACvB,QAAM;AACFN,IAAAA,WADE;AAEFC,IAAAA,YAFE;AAGFC,IAAAA;AAHE,MAIFI,SAJJ;AAKAF,EAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmB9B,IAAI,CAACyB,WAAD,CAAvB;AACA,SAAO,IAAP,CAtCQ,CAwCR;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACC,CAhIM;;GAAMlB,W;UASgBR,c,EA2BLM,a","sourcesContent":["import { useContractKit } from \"@celo-tools/use-contractkit\";\nimport { BigNumber } from \"@ethersproject/bignumber\";\nimport { useEffect, useState } from \"react\";\nimport { Token } from \"src/utils/token\";\nimport { AbiItem, toBN, isAddress } from \"web3-utils\";\nimport BN from \"bn.js\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\"\nimport CERC20_ABI from \"src/abis/fountain_of_youth/CErc20Immutable.json\"\nimport { HomoraBank } from \"src/generated/HomoraBank\";\nimport { CErc20Immutable } from \"src/generated/CErc20Immutable\";\nimport { Bank } from \"src/config\";\nimport React from \"react\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\nimport { getAddress } from \"ethers/lib/utils\";\nimport { ChainId } from \"@celo-tools/use-contractkit\";\n\n\n\n/**\n * (Projected) APY: homoraBank.banks(token).ctoken.interestRateModel.getSupplyRate(\n * Total Supply,\n * total Borrow,\n * homoraBank.banks(token).ctoken.totalReserves(),\n * homoraBank.banks(token).ctoken.reserveFactorMantissa())\n *\n * Total Supply: homoraBank.banks(token).ctoken.totalSupply()\n * Total Borrow: homoraBank.banks(token).ctoken.totalBorrows()\n * Utilization: jumpRateModel.utilizationRate(Total Supply, Total Borrow, homoraBank.banks(token).ctoken.totalReserves()\n * Balance: safeBox.balanceOf(address)\n */\nexport const useEarnPool = (\n  token: Token\n): {\n  totalReserves: BN;\n  totalSupply: BN;\n  totalBorrows: BN;\n  utilizationRate: BN;\n  projectedAPY: BN;\n} | null => {\n    const { kit, network } = useContractKit();\n    //TODO: flag wrong chain id's\n    const bank = React.useMemo(() => (new kit.web3.eth.Contract(\n        BANK_ABI.abi as AbiItem[],\n        getAddress(Bank[network.chainId])\n    ) as unknown) as HomoraBank, [kit, network]); \n    const call = React.useCallback(async () => {\n        try {\n            const bankInfo =  await bank.methods.getBankInfo(token.address).call();\n            const cToken = (new kit.web3.eth.Contract(\n                CERC20_ABI as AbiItem[],\n                bankInfo.cToken\n            ) as unknown) as CErc20Immutable;\n            const totalSupply = await cToken.methods.totalSupply().call();\n            const totalBorrows = await cToken.methods.totalBorrows().call();\n            const totalReserves = await cToken.methods.totalReserves().call();\n            return {\n                totalSupply,\n                totalBorrows,\n                totalReserves,\n            }\n        } catch (error) {\n            console.log(error)\n        }\n        \n    }, [bank, token.address])\n\n    const [tokenInfo] = useAsyncState(null, call);\n    console.log('tokenInfo', tokenInfo)\n\n    if (tokenInfo == null) return null;\n    const {\n        totalSupply,\n        totalBorrows, \n        totalReserves,\n    } = tokenInfo;\n    console.log(\"ere\", toBN(totalSupply))\n    return null\n\n    // const {\n    //     totalSupply,\n    //     totalBorrows, \n    //     totalReserves,\n    // } = tokenInfo;\n\n    // return {\n    //     totalSupply: toBN(totalSupply),\n    //     totalBorrows: toBN(totalBorrows),\n    //     totalReserves: toBN(totalReserves),\n    //     utilizationRate: toBN(0),\n    //     projectedAPY: toBN(0),\n    // };\n\n//   const [cToken, setCToken] = useState<CToken | null>(null);\n//   useEffect(() => {\n//     void (async () => {\n//       try {\n//         const { cToken: cTokenAddress } = await bank.getBankInfo(token.address);\n//         setCToken(CToken__factory.connect(cTokenAddress, provider));\n//       } catch (e) {\n//         console.error(\"Could not fetch cToken\", e);\n//         Sentry.captureException(e);\n//         return;\n//       }\n//     })();\n//   }, [bank, provider, token]);\n\n//   const [info, setInfo] = useState<{\n//     totalReserves: TokenAmount;\n//     totalSupply: TokenAmount;\n//     totalBorrows: TokenAmount;\n//     utilizationRate: BigNumber;\n//     projectedAPY: BigNumber;\n//   } | null>(null);\n//   useEffect(() => {\n//     void (async () => {\n//       if (!cToken) {\n//         setInfo(null);\n//         return;\n//       }\n//       try {\n//         const interestRateModelAddress = await cToken.interestRateModel();\n//         const interestRateModel = JumpRateModelV2__factory.connect(\n//           interestRateModelAddress,\n//           provider\n//         );\n//         const info = {\n//           totalReserves: await cToken.totalReserves(),\n//           totalSupply: await cToken.totalSupply(),\n//           totalBorrows: await cToken.totalBorrows(),\n//           reserveFactorMantissa: await cToken.reserveFactorMantissa(),\n//         };\n//         const utilizationRate = await interestRateModel.utilizationRate(\n//           info.totalSupply,\n//           info.totalBorrows,\n//           info.totalReserves\n//         );\n//         const supplyRate = await interestRateModel.getSupplyRate(\n//           info.totalSupply,\n//           info.totalBorrows,\n//           info.totalReserves,\n//           info.reserveFactorMantissa\n//         );\n//         setInfo({\n//           totalSupply: new TokenAmount(token, info.totalSupply.toString()),\n//           totalBorrows: new TokenAmount(token, info.totalBorrows.toString()),\n//           totalReserves: new TokenAmount(token, info.totalReserves.toString()),\n//           utilizationRate,\n//           projectedAPY: supplyRate,\n//         });\n//       } catch (e) {\n//         console.error(\"Could not fetch pool data\", e);\n//         Sentry.captureException(e);\n//         return;\n//       }\n//     })();\n//   }, [cToken, provider, token]);\n\n//   return info;\n};\n"]},"metadata":{},"sourceType":"module"}