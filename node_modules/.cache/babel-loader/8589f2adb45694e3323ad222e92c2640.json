{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useContractKit } from \"@celo-tools/use-contractkit\";\nimport { toBN } from \"web3-utils\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\";\nimport CERC20_ABI from \"src/abis/fountain_of_youth/CErc20Immutable.json\";\nimport { Bank } from \"src/config\";\nimport React from \"react\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\n/**\n * (Projected) APY: homoraBank.banks(token).ctoken.interestRateModel.getSupplyRate(\n * Total Supply,\n * total Borrow,\n * homoraBank.banks(token).ctoken.totalReserves(),\n * homoraBank.banks(token).ctoken.reserveFactorMantissa())\n *\n * Total Supply: homoraBank.banks(token).ctoken.totalSupply()\n * Total Borrow: homoraBank.banks(token).ctoken.totalBorrows()\n * Utilization: jumpRateModel.utilizationRate(Total Supply, Total Borrow, homoraBank.banks(token).ctoken.totalReserves()\n * Balance: safeBox.balanceOf(address)\n */\n\nexport const useEarnPool = token => {\n  _s();\n\n  const {\n    kit,\n    network\n  } = useContractKit();\n  const bank = React.useMemo(() => new kit.web3.eth.Contract(BANK_ABI, Bank[network.chainId]), [kit, network]);\n  const call = React.useCallback(async () => {\n    const bankInfo = await bank.methods.banks(token.address).call();\n    const cToken = new kit.web3.eth.Contract(CERC20_ABI, bankInfo.cToken);\n    const totalSupply = await cToken.methods.totalSupply().call();\n    const totalBorrows = await cToken.methods.totalBorrows().call();\n    const totalReserves = await cToken.methods.totalReserves().call();\n    return {\n      totalSupply,\n      totalBorrows,\n      totalReserves\n    };\n  }, [bank, token.address]);\n  const [tokenInfo] = useAsyncState(null, call);\n  if (tokenInfo == null) return null;\n  const {\n    totalSupply,\n    totalBorrows,\n    totalReserves\n  } = tokenInfo;\n  return {\n    totalSupply: toBN(totalSupply),\n    totalBorrows: toBN(totalBorrows),\n    totalReserves: toBN(totalReserves),\n    utilizationRate: toBN(0),\n    projectedAPY: toBN(0)\n  }; //   const [cToken, setCToken] = useState<CToken | null>(null);\n  //   useEffect(() => {\n  //     void (async () => {\n  //       try {\n  //         const { cToken: cTokenAddress } = await bank.getBankInfo(token.address);\n  //         setCToken(CToken__factory.connect(cTokenAddress, provider));\n  //       } catch (e) {\n  //         console.error(\"Could not fetch cToken\", e);\n  //         Sentry.captureException(e);\n  //         return;\n  //       }\n  //     })();\n  //   }, [bank, provider, token]);\n  //   const [info, setInfo] = useState<{\n  //     totalReserves: TokenAmount;\n  //     totalSupply: TokenAmount;\n  //     totalBorrows: TokenAmount;\n  //     utilizationRate: BigNumber;\n  //     projectedAPY: BigNumber;\n  //   } | null>(null);\n  //   useEffect(() => {\n  //     void (async () => {\n  //       if (!cToken) {\n  //         setInfo(null);\n  //         return;\n  //       }\n  //       try {\n  //         const interestRateModelAddress = await cToken.interestRateModel();\n  //         const interestRateModel = JumpRateModelV2__factory.connect(\n  //           interestRateModelAddress,\n  //           provider\n  //         );\n  //         const info = {\n  //           totalReserves: await cToken.totalReserves(),\n  //           totalSupply: await cToken.totalSupply(),\n  //           totalBorrows: await cToken.totalBorrows(),\n  //           reserveFactorMantissa: await cToken.reserveFactorMantissa(),\n  //         };\n  //         const utilizationRate = await interestRateModel.utilizationRate(\n  //           info.totalSupply,\n  //           info.totalBorrows,\n  //           info.totalReserves\n  //         );\n  //         const supplyRate = await interestRateModel.getSupplyRate(\n  //           info.totalSupply,\n  //           info.totalBorrows,\n  //           info.totalReserves,\n  //           info.reserveFactorMantissa\n  //         );\n  //         setInfo({\n  //           totalSupply: new TokenAmount(token, info.totalSupply.toString()),\n  //           totalBorrows: new TokenAmount(token, info.totalBorrows.toString()),\n  //           totalReserves: new TokenAmount(token, info.totalReserves.toString()),\n  //           utilizationRate,\n  //           projectedAPY: supplyRate,\n  //         });\n  //       } catch (e) {\n  //         console.error(\"Could not fetch pool data\", e);\n  //         Sentry.captureException(e);\n  //         return;\n  //       }\n  //     })();\n  //   }, [cToken, provider, token]);\n  //   return info;\n};\n\n_s(useEarnPool, \"laJ65aA+83HsAG24vsLPDtwUifw=\", false, function () {\n  return [useContractKit, useAsyncState];\n});","map":{"version":3,"sources":["/Users/kylescott/src/nomspace-interface/src/components/useEarnPool.ts"],"names":["useContractKit","toBN","BANK_ABI","CERC20_ABI","Bank","React","useAsyncState","useEarnPool","token","kit","network","bank","useMemo","web3","eth","Contract","chainId","call","useCallback","bankInfo","methods","banks","address","cToken","totalSupply","totalBorrows","totalReserves","tokenInfo","utilizationRate","projectedAPY"],"mappings":";;AAAA,SAASA,cAAT,QAA+B,6BAA/B;AAIA,SAAkBC,IAAlB,QAAyC,YAAzC;AAEA,OAAOC,QAAP,MAAqB,2CAArB;AACA,OAAOC,UAAP,MAAuB,iDAAvB;AAGA,SAASC,IAAT,QAAqB,YAArB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,aAAT,QAA8B,yBAA9B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMC,WAAW,GACtBC,KADyB,IAQf;AAAA;;AACR,QAAM;AAAEC,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAmBV,cAAc,EAAvC;AAEA,QAAMW,IAAI,GAAGN,KAAK,CAACO,OAAN,CAAc,MAAO,IAAIH,GAAG,CAACI,IAAJ,CAASC,GAAT,CAAaC,QAAjB,CAC9Bb,QAD8B,EAE9BE,IAAI,CAACM,OAAO,CAACM,OAAT,CAF0B,CAArB,EAGgB,CAACP,GAAD,EAAMC,OAAN,CAHhB,CAAb;AAKA,QAAMO,IAAI,GAAGZ,KAAK,CAACa,WAAN,CAAkB,YAAY;AACvC,UAAMC,QAAQ,GAAI,MAAMR,IAAI,CAACS,OAAL,CAAaC,KAAb,CAAmBb,KAAK,CAACc,OAAzB,EAAkCL,IAAlC,EAAxB;AACA,UAAMM,MAAM,GAAI,IAAId,GAAG,CAACI,IAAJ,CAASC,GAAT,CAAaC,QAAjB,CACZZ,UADY,EAEZgB,QAAQ,CAACI,MAFG,CAAhB;AAIA,UAAMC,WAAW,GAAG,MAAMD,MAAM,CAACH,OAAP,CAAeI,WAAf,GAA6BP,IAA7B,EAA1B;AACA,UAAMQ,YAAY,GAAG,MAAMF,MAAM,CAACH,OAAP,CAAeK,YAAf,GAA8BR,IAA9B,EAA3B;AACA,UAAMS,aAAa,GAAG,MAAMH,MAAM,CAACH,OAAP,CAAeM,aAAf,GAA+BT,IAA/B,EAA5B;AACA,WAAO;AACHO,MAAAA,WADG;AAEHC,MAAAA,YAFG;AAGHC,MAAAA;AAHG,KAAP;AAKH,GAdY,EAcV,CAACf,IAAD,EAAOH,KAAK,CAACc,OAAb,CAdU,CAAb;AAgBA,QAAM,CAACK,SAAD,IAAcrB,aAAa,CAAC,IAAD,EAAOW,IAAP,CAAjC;AAEA,MAAIU,SAAS,IAAI,IAAjB,EAAuB,OAAO,IAAP;AAEvB,QAAM;AACFH,IAAAA,WADE;AAEFC,IAAAA,YAFE;AAGFC,IAAAA;AAHE,MAIFC,SAJJ;AAOA,SAAO;AACHH,IAAAA,WAAW,EAAEvB,IAAI,CAACuB,WAAD,CADd;AAEHC,IAAAA,YAAY,EAAExB,IAAI,CAACwB,YAAD,CAFf;AAGHC,IAAAA,aAAa,EAAEzB,IAAI,CAACyB,aAAD,CAHhB;AAIHE,IAAAA,eAAe,EAAE3B,IAAI,CAAC,CAAD,CAJlB;AAKH4B,IAAAA,YAAY,EAAE5B,IAAI,CAAC,CAAD;AALf,GAAP,CAnCQ,CA2CZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACC,CArHM;;GAAMM,W;UASgBP,c,EAuBLM,a","sourcesContent":["import { useContractKit } from \"@celo-tools/use-contractkit\";\nimport { BigNumber } from \"@ethersproject/bignumber\";\nimport { useEffect, useState } from \"react\";\nimport { Token } from \"src/utils/token\";\nimport { AbiItem, toBN, isAddress } from \"web3-utils\";\nimport BN from \"bn.js\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\"\nimport CERC20_ABI from \"src/abis/fountain_of_youth/CErc20Immutable.json\"\nimport { HomoraBank } from \"src/generated/HomoraBank\";\nimport { CErc20Immutable } from \"src/generated/CErc20Immutable\";\nimport { Bank } from \"src/config\";\nimport React from \"react\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\n\n/**\n * (Projected) APY: homoraBank.banks(token).ctoken.interestRateModel.getSupplyRate(\n * Total Supply,\n * total Borrow,\n * homoraBank.banks(token).ctoken.totalReserves(),\n * homoraBank.banks(token).ctoken.reserveFactorMantissa())\n *\n * Total Supply: homoraBank.banks(token).ctoken.totalSupply()\n * Total Borrow: homoraBank.banks(token).ctoken.totalBorrows()\n * Utilization: jumpRateModel.utilizationRate(Total Supply, Total Borrow, homoraBank.banks(token).ctoken.totalReserves()\n * Balance: safeBox.balanceOf(address)\n */\nexport const useEarnPool = (\n  token: Token\n): {\n  totalReserves: BN;\n  totalSupply: BN;\n  totalBorrows: BN;\n  utilizationRate: BN;\n  projectedAPY: BN;\n} | null => {\n    const { kit, network } = useContractKit();\n\n    const bank = React.useMemo(() => (new kit.web3.eth.Contract(\n        BANK_ABI as AbiItem,\n        Bank[network.chainId]\n    ) as unknown) as HomoraBank, [kit, network]); \n\n    const call = React.useCallback(async () => {\n        const bankInfo =  await bank.methods.banks(token.address).call();\n        const cToken = (new kit.web3.eth.Contract(\n            CERC20_ABI as AbiItem[],\n            bankInfo.cToken\n        ) as unknown) as CErc20Immutable;\n        const totalSupply = await cToken.methods.totalSupply().call();\n        const totalBorrows = await cToken.methods.totalBorrows().call();\n        const totalReserves = await cToken.methods.totalReserves().call();\n        return {\n            totalSupply,\n            totalBorrows,\n            totalReserves,\n        }\n    }, [bank, token.address])\n\n    const [tokenInfo] = useAsyncState(null, call);\n\n    if (tokenInfo == null) return null;\n\n    const {\n        totalSupply,\n        totalBorrows, \n        totalReserves,\n    } = tokenInfo;\n\n\n    return {\n        totalSupply: toBN(totalSupply),\n        totalBorrows: toBN(totalBorrows),\n        totalReserves: toBN(totalReserves),\n        utilizationRate: toBN(0),\n        projectedAPY: toBN(0),\n    };\n\n//   const [cToken, setCToken] = useState<CToken | null>(null);\n//   useEffect(() => {\n//     void (async () => {\n//       try {\n//         const { cToken: cTokenAddress } = await bank.getBankInfo(token.address);\n//         setCToken(CToken__factory.connect(cTokenAddress, provider));\n//       } catch (e) {\n//         console.error(\"Could not fetch cToken\", e);\n//         Sentry.captureException(e);\n//         return;\n//       }\n//     })();\n//   }, [bank, provider, token]);\n\n//   const [info, setInfo] = useState<{\n//     totalReserves: TokenAmount;\n//     totalSupply: TokenAmount;\n//     totalBorrows: TokenAmount;\n//     utilizationRate: BigNumber;\n//     projectedAPY: BigNumber;\n//   } | null>(null);\n//   useEffect(() => {\n//     void (async () => {\n//       if (!cToken) {\n//         setInfo(null);\n//         return;\n//       }\n//       try {\n//         const interestRateModelAddress = await cToken.interestRateModel();\n//         const interestRateModel = JumpRateModelV2__factory.connect(\n//           interestRateModelAddress,\n//           provider\n//         );\n//         const info = {\n//           totalReserves: await cToken.totalReserves(),\n//           totalSupply: await cToken.totalSupply(),\n//           totalBorrows: await cToken.totalBorrows(),\n//           reserveFactorMantissa: await cToken.reserveFactorMantissa(),\n//         };\n//         const utilizationRate = await interestRateModel.utilizationRate(\n//           info.totalSupply,\n//           info.totalBorrows,\n//           info.totalReserves\n//         );\n//         const supplyRate = await interestRateModel.getSupplyRate(\n//           info.totalSupply,\n//           info.totalBorrows,\n//           info.totalReserves,\n//           info.reserveFactorMantissa\n//         );\n//         setInfo({\n//           totalSupply: new TokenAmount(token, info.totalSupply.toString()),\n//           totalBorrows: new TokenAmount(token, info.totalBorrows.toString()),\n//           totalReserves: new TokenAmount(token, info.totalReserves.toString()),\n//           utilizationRate,\n//           projectedAPY: supplyRate,\n//         });\n//       } catch (e) {\n//         console.error(\"Could not fetch pool data\", e);\n//         Sentry.captureException(e);\n//         return;\n//       }\n//     })();\n//   }, [cToken, provider, token]);\n\n//   return info;\n};\n"]},"metadata":{},"sourceType":"module"}