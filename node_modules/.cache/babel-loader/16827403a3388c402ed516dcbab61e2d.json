{"ast":null,"code":"var _jsxFileName = \"/Users/kylescott/src/nomspace-interface/src/pages/Position/Position.tsx\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport { useContractKit } from \"@celo-tools/use-contractkit\";\nimport { toBN } from \"web3-utils\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\";\nimport { getAddress } from \"ethers/lib/utils\";\nimport { Bank } from \"src/config\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\nimport { FARMS } from \"src/config\";\nimport { Spinner, Flex } from \"theme-ui\";\nimport { PositionEntry } from \"src/pages/Position/PositionEntry\";\nimport { Container, Title, Description, Wrapper, Background, CardContainer } from \"src/components/MainPages\";\nimport Image from 'src/images/background.png';\nimport { SimpleTable } from \"src/components/SimpleTable\";\nimport { css } from \"@emotion/react\";\nimport IERC20W_ABI from \"src/abis/dahlia_contracts/IERC20Wrapper.json\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Position = () => {\n  _s();\n\n  const {\n    kit,\n    address\n  } = useContractKit();\n  const bank = React.useMemo(() => new kit.web3.eth.Contract(BANK_ABI.abi, getAddress(Bank[42220])), [kit]);\n  const call = React.useCallback(async () => {\n    try {\n      let posInfo = [];\n      const nextPositionId = await bank.methods.nextPositionId().call();\n\n      for (let i = 1; i < Number(nextPositionId); i += 1) {\n        posInfo.push({ ...(await bank.methods.getPositionInfo(i).call()),\n          positonId: i\n        });\n      }\n\n      return posInfo;\n    } catch (error) {\n      console.log(error);\n    }\n  }, [bank]);\n  const [info] = useAsyncState(null, call);\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: [/*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(Title, {\n        children: \"Positions\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Description, {\n        children: \"Manage your positions with ease.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CardContainer, {\n      children: /*#__PURE__*/_jsxDEV(SimpleTable, {\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              css: css`\n                  text-align: left !important;\n                `,\n              children: \"Pool\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 59,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Borrow Value\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 66,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Total Value\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 67,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Debt Ratio \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 68,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"APY\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 69,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 70,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 58,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 57,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: info ? info.filter(pos => pos.owner === address).flatMap(pos => {\n            const active = FARMS.filter(async farm => {\n              const wrapper = new kit.web3.eth.Contract(IERC20W_ABI.abi, pos.collToken);\n              const underlying = await wrapper.methods.getUnderlyingToken(pos.collId).call();\n              return farm.lp === getAddress(toBN(pos.collId).toString(16));\n            });\n            return {\n              pos,\n              active\n            };\n          }).map(info => /*#__PURE__*/_jsxDEV(PositionEntry, {\n            collId: info.pos.collId,\n            collateralSize: info.pos.collateralSize,\n            positionId: info.pos.positonId,\n            pool: info.active[0]\n          }, info.pos.positonId, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 15\n          }, this)) : /*#__PURE__*/_jsxDEV(Flex, {\n            sx: {\n              alignItems: \"center\",\n              justifyContent: \"center\"\n            },\n            children: /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 90,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 14\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Background, {\n      src: Image,\n      alt: \"Background Logo\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 50,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Position, \"mHfQXYEl6HAYxdaLEEz5GnqHxqw=\", false, function () {\n  return [useContractKit, useAsyncState];\n});\n\n_c = Position;\nexport default Position;\n\nvar _c;\n\n$RefreshReg$(_c, \"Position\");","map":{"version":3,"sources":["/Users/kylescott/src/nomspace-interface/src/pages/Position/Position.tsx"],"names":["React","useContractKit","toBN","BANK_ABI","getAddress","Bank","useAsyncState","FARMS","Spinner","Flex","PositionEntry","Container","Title","Description","Wrapper","Background","CardContainer","Image","SimpleTable","css","IERC20W_ABI","Position","kit","address","bank","useMemo","web3","eth","Contract","abi","call","useCallback","posInfo","nextPositionId","methods","i","Number","push","getPositionInfo","positonId","error","console","log","info","filter","pos","owner","flatMap","active","farm","wrapper","collToken","underlying","getUnderlyingToken","collId","lp","toString","map","collateralSize","alignItems","justifyContent"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useContractKit } from \"@celo-tools/use-contractkit\";\nimport { AbiItem, toBN } from \"web3-utils\";\nimport { HomoraBank } from \"src/generated/HomoraBank\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\";\nimport { getAddress } from \"ethers/lib/utils\";\nimport { Bank } from \"src/config\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\nimport { FARMS } from \"src/config\";\nimport { Spinner, Flex } from \"theme-ui\";\nimport { PositionEntry } from \"src/pages/Position/PositionEntry\"\nimport {\n    Container, \n    Title, \n    Description,\n    Wrapper,\n    Background,\n    CardContainer,\n} from \"src/components/MainPages\";\nimport Image from 'src/images/background.png';\nimport { SimpleTable } from \"src/components/SimpleTable\";\nimport { css } from \"@emotion/react\";\nimport { IERC20Wrapper } from 'src/generated/IERC20Wrapper';\nimport IERC20W_ABI from \"src/abis/dahlia_contracts/IERC20Wrapper.json\";\n\n\nconst Position = () => {\n  const { kit, address } = useContractKit();\n\n  const bank = React.useMemo(() => (new kit.web3.eth.Contract(\n    BANK_ABI.abi as AbiItem[],\n    getAddress(Bank[42220])\n  ) as unknown) as HomoraBank, [kit]); \n\n  const call = React.useCallback(async () => {\n    try {\n      let posInfo = []\n      const nextPositionId = await bank.methods.nextPositionId().call(); \n      for (let i = 1; i < Number(nextPositionId); i += 1) {\n        posInfo.push({...await bank.methods.getPositionInfo(i).call(), positonId: i})\n      }\n      return posInfo;  \n    } catch (error) {\n        console.log(error)\n    }  \n}, [bank])\n\n  const [info] = useAsyncState(null, call);\n  return (\n    <Wrapper>\n      <Container>\n        <Title>Positions</Title>\n        <Description>Manage your positions with ease.</Description>\n      </Container>\n      <CardContainer>\n        <SimpleTable>\n          <thead>\n            <tr>\n              <th\n                css={css`\n                  text-align: left !important;\n                `}\n              >\n                Pool\n              </th>\n              <th>Borrow Value</th>\n              <th>Total Value</th>\n              <th>Debt Ratio </th>\n              <th>APY</th>\n              <th />\n            </tr>\n          </thead>\n          <tbody>\n            { info ? \n              info.filter((pos) => pos.owner === address)\n              .flatMap((pos) => {\n                const active = FARMS.filter(async (farm) => {\n                  const wrapper = (new kit.web3.eth.Contract(\n                    IERC20W_ABI.abi as AbiItem[],\n                    pos.collToken,\n                    ) as unknown) as IERC20Wrapper;\n                  const underlying = await wrapper.methods.getUnderlyingToken(pos.collId).call();\n                  return farm.lp === getAddress(toBN(pos.collId).toString(16))\n                })\n              return {pos, active}\n            }).map((info) => (\n              <PositionEntry key={info.pos.positonId} collId={info.pos.collId} collateralSize={info.pos.collateralSize} positionId={info.pos.positonId} pool={info.active[0]!} />\n            )) : \n            (<Flex sx={{ alignItems: \"center\", justifyContent: \"center\"}}>\n              <Spinner />\n            </Flex>)\n            }\n            \n          </tbody>\n        </SimpleTable>\n      </CardContainer>\n      <Background src={Image} alt='Background Logo' />\n    </Wrapper>\n  );\n};\n\nexport default Position;\n"]},"metadata":{},"sourceType":"module"}