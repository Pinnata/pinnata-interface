{"ast":null,"code":"var _jsxFileName = \"/Users/kylescott/src/dahlia-interface/src/pages/Position/Position.tsx\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport { useContractKit } from \"@celo-tools/use-contractkit\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\";\nimport { getAddress } from \"ethers/lib/utils\";\nimport { Bank } from \"src/config\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\nimport { FARMS } from \"src/config\";\nimport { PositionEntry } from \"src/pages/Position/PositionEntry\";\nimport { SimpleTable } from \"src/components/SimpleTable\";\nimport { css } from \"@emotion/react\";\nimport IERC20W_ABI from \"src/abis/dahlia_contracts/IERC20Wrapper.json\";\nimport { Flex, Text, Card, Spinner } from \"theme-ui\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Position = () => {\n  _s();\n\n  const {\n    kit,\n    address\n  } = useContractKit();\n  const bank = React.useMemo(() => new kit.web3.eth.Contract(BANK_ABI.abi, getAddress(Bank[42220])), [kit]);\n  const call = React.useCallback(async () => {\n    try {\n      const info = [];\n      const nextPositionId = await bank.methods.nextPositionId().call();\n\n      for (let i = 1; i < Number(nextPositionId); i += 1) {\n        const positionInfo = await bank.methods.getPositionInfo(i).call();\n        console.log(positionInfo, i);\n        const wrapper = new kit.web3.eth.Contract(IERC20W_ABI.abi, positionInfo.collToken);\n        const underlying = await wrapper.methods.getUnderlyingToken(positionInfo.collId).call();\n        console.log(underlying);\n\n        for (let farm of FARMS) {\n          if (getAddress(underlying) === farm.lp && getAddress(positionInfo.owner) === getAddress(address)) {\n            info.push({\n              collId: positionInfo.collId,\n              collateralSize: positionInfo.collateralSize,\n              positionId: i,\n              farm: farm\n            });\n            break;\n          }\n        }\n      }\n\n      return info;\n    } catch (error) {\n      console.log(error);\n    }\n  }, [bank.methods, kit.web3.eth.Contract, address]);\n  const [info] = useAsyncState(null, call);\n  return /*#__PURE__*/_jsxDEV(Flex, {\n    sx: {\n      flexDirection: \"column\",\n      alignItems: \"center\",\n      width: \"100%\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(Text, {\n      children: \"Positions\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(Text, {\n      children: \"Manage your positions with ease.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(Card, {\n      sx: {\n        width: \"100%\",\n        maxWidth: \"1000px\",\n        mt: \"16px\"\n      },\n      py: 4,\n      px: 3,\n      children: /*#__PURE__*/_jsxDEV(SimpleTable, {\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              css: css`\n                  text-align: left !important;\n                `,\n              children: \"Pool\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 68,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Borrow Value\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 75,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Total Value\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 76,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Debt Ratio \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 77,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"APY\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 78,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 79,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 67,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: info ? info.map(x => /*#__PURE__*/_jsxDEV(PositionEntry, {\n            collId: x.collId,\n            collateralSize: x.collateralSize,\n            positionId: x.positionId,\n            pool: x.farm\n          }, x.positionId, false, {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 15\n          }, this)) : /*#__PURE__*/_jsxDEV(Flex, {\n            sx: {\n              alignItems: \"center\",\n              justifyContent: \"center\"\n            },\n            children: /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 88,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 14\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 61,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Position, \"mHfQXYEl6HAYxdaLEEz5GnqHxqw=\", false, function () {\n  return [useContractKit, useAsyncState];\n});\n\n_c = Position;\n\nvar _c;\n\n$RefreshReg$(_c, \"Position\");","map":{"version":3,"sources":["/Users/kylescott/src/dahlia-interface/src/pages/Position/Position.tsx"],"names":["React","useContractKit","BANK_ABI","getAddress","Bank","useAsyncState","FARMS","PositionEntry","SimpleTable","css","IERC20W_ABI","Flex","Text","Card","Spinner","Position","kit","address","bank","useMemo","web3","eth","Contract","abi","call","useCallback","info","nextPositionId","methods","i","Number","positionInfo","getPositionInfo","console","log","wrapper","collToken","underlying","getUnderlyingToken","collId","farm","lp","owner","push","collateralSize","positionId","error","flexDirection","alignItems","width","maxWidth","mt","map","x","justifyContent"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useContractKit } from \"@celo-tools/use-contractkit\";\nimport { AbiItem, toBN } from \"web3-utils\";\nimport { HomoraBank } from \"src/generated/HomoraBank\";\nimport BANK_ABI from \"src/abis/dahlia_contracts/HomoraBank.json\";\nimport { getAddress } from \"ethers/lib/utils\";\nimport { Bank } from \"src/config\";\nimport { useAsyncState } from \"src/hooks/useAsyncState\";\nimport { FARMS } from \"src/config\";\nimport { PositionEntry } from \"src/pages/Position/PositionEntry\"\nimport Image from 'src/images/background.png';\nimport { SimpleTable } from \"src/components/SimpleTable\";\nimport { css } from \"@emotion/react\";\nimport { IERC20Wrapper } from 'src/generated/IERC20Wrapper';\nimport IERC20W_ABI from \"src/abis/dahlia_contracts/IERC20Wrapper.json\";\nimport { Flex, Text, Card, Spinner } from \"theme-ui\";\n\n\n\nexport const Position = () => {\n  const { kit, address } = useContractKit();\n\n  const bank = React.useMemo(() => (new kit.web3.eth.Contract(\n    BANK_ABI.abi as AbiItem[],\n    getAddress(Bank[42220])\n  ) as unknown) as HomoraBank, [kit]); \n\n  const call = React.useCallback(async () => {\n    try {\n      const info = [];\n      const nextPositionId = await bank.methods.nextPositionId().call(); \n      for (let i = 1; i < Number(nextPositionId); i += 1) {\n        const positionInfo = await bank.methods.getPositionInfo(i).call();\n        console.log(positionInfo, i); \n        const wrapper = (new kit.web3.eth.Contract(\n          IERC20W_ABI.abi as AbiItem[],\n          positionInfo.collToken,\n          ) as unknown) as IERC20Wrapper;\n        const underlying = await wrapper.methods.getUnderlyingToken(positionInfo.collId).call(); \n        console.log(underlying);\n        for (let farm of FARMS) {\n          if (getAddress(underlying) === farm.lp && getAddress(positionInfo.owner) === getAddress(address!)) {\n            info.push({\n              collId: positionInfo.collId, \n              collateralSize: positionInfo.collateralSize,\n              positionId: i,\n              farm: farm,\n            })\n            break;\n          }\n        }\n      }\n      return info;  \n    } catch (error) {\n        console.log(error)\n    }  \n}, [bank.methods, kit.web3.eth.Contract, address])\n\n  const [info] = useAsyncState(null, call);\n  return (\n    <Flex sx={{flexDirection: \"column\", alignItems: \"center\", width: \"100%\"}}>\n    <Text>Positions</Text>\n    <Text>Manage your positions with ease.</Text>\n    <Card sx={{ width: \"100%\", maxWidth: \"1000px\", mt: \"16px\" }} py={4} px={3}>\n    <SimpleTable>\n          <thead>\n            <tr>\n              <th\n                css={css`\n                  text-align: left !important;\n                `}\n              >\n                Pool\n              </th>\n              <th>Borrow Value</th>\n              <th>Total Value</th>\n              <th>Debt Ratio </th>\n              <th>APY</th>\n              <th />\n            </tr>\n          </thead>\n          <tbody>\n            { info ? \n              info.map((x) => (\n              <PositionEntry key={x.positionId} collId={x.collId} collateralSize={x.collateralSize} positionId={x.positionId} pool={x.farm!} />\n            )) : \n            (<Flex sx={{ alignItems: \"center\", justifyContent: \"center\"}}>\n              <Spinner />\n            </Flex>)\n            }\n            \n          </tbody>\n        </SimpleTable>\n    </Card>\n  </Flex>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}